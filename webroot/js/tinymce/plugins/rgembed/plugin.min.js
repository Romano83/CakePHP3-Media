(function (tinymce, rg) {

    tinymce.PluginManager.add('rgembed', function(editor) {

        // scan new content for matching view patterns
        editor.on('beforesetcontent', function(event) {
            var node;

            if (!event.content) {
                return;
            }

            if (!event.load) {
                node = editor.selection.getNode();

                if (node && node !== editor.getBody() && /^\s*https?:\/\/\S+\s*$/i.test( event.content )) {
                    node = editor.dom.getParent(node, 'p');

                    if (node && /^[\s\uFEFF\u00A0]*$/.test( editor.$( node ).text() || '' ) ) {
                        node.innerHTML = '';
                    } else {
                        return;
                    }
                }
            }

            event.content = rg.mce.views.setMarkers(event.content);

        });

    });

})(tinymce, window.rg);