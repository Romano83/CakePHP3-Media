tinymce.PluginManager.requireLangPack('gallery', 'fr_FR');

tinymce.PluginManager.add('gallery', function(ed, url){		

	ed.addButton('image', {

		title: 'Gallery',
		icon: 'image',
		tooltip: 'Image',
		onclick: function(){

			var el = ed.selection.getNode();
			var url = tinymce.activeEditor.settings.gallery_explorer;
			var title = 'Gallery';

			if(el.nodeName == 'IMG'){
				title = 'Picture details';
				url = tinymce.activeEditor.settings.gallery_edit;
				url += '&media_id='+encodeURIComponent(ed.dom.getAttrib(el, 'data-id'))+'&alt='+encodeURIComponent(ed.dom.getAttrib(el, 'alt'))+'&class='+encodeURIComponent(ed.dom.getAttrib(el, 'class'));
				var xhr = new XMLHttpRequest();
				xhr.open("GET", url, true);
				xhr.send(null);
			}

			ed.windowManager.open({	
				title: title,			
				url: url,
				width: window.innerWidth - 100,
				height: window.innerHeight - 100,
				inline: 1,
				resizable: true,
				maximizable: true
			});	

		}

	});

});

function send_to_tinymce(content, win){
	var ed = tinymce.activeEditor;
	ed.insertContent(content);
	ed.windowManager.close(win);
}

function update_to_tinymce(content, win){
	var ed = tinymce.activeEditor;
	var el = ed.selection.getNode();
	/*if(content.search("<figure>") != -1){
		var figure = el.parentElement.parentElement;
		el = figure;
		console.log(el);
		console.log(content);
		console.log(figure);
		if(figure.nodeName == 'FIGURE'){
			ed.execCommand('mceReplaceContent', false, content);
			ed.windowManager.close(win);
		}
	}*/
	ed.execCommand('mceReplaceContent', false, content);
	ed.windowManager.close(win);
	
	
}
